{% extends 'reviews/base.html' %}
{% load staticfiles %}

{% block title_block %}
  {{ heading }}
{% endblock %}

{% block stylesheets_block %}
  <link rel="stylesheet" type="text/css" href="{% static 'css/profile.css' %}">
  <link rel="stylesheet" type="text/css" href="{% static 'css/forms.css' %}">
{% endblock %}

{% block body_block %}
  <h1>{{ heading }}</h1>
  <div class="container w-100">
    <div class="row">
      <!-- Profile Pic -->
      <div class="col-sm-4">
        <h2>{{ profile_form.profile_image.help_text }}</h2>
        <div class="container-fluid p-5">
          <div class="row">
            {% if profile.profile_image %}
              <img class="profile_image mx-auto"
                src="{{ profile.profile_image.url }}"
                alt="profile image">
            {% else %}No image.{% endif %}
          </div>
          <form action="{% url 'edit_profile' user.username %}" method="post"
              enctype="multipart/form-data">
            {% csrf_token %}
            <div class="row my-5 mx-auto">
              {{ profile_form.profile_image }}
            </div>
            <!-- Submit button -->
            <div class="form-row clearfix">
              <button class="float-right btn btn-secondary"
              type="submit" name="image_button">Submit</button>
            </div>
          </form>
        </div>
      </div>
      <!-- Details -->
      <div class="col">
        <h2>Details</h2>
        <div class="container-fluid p-5">
          <!-- Personal Details -->
          <h3 class="pt-0">Personal</h3>
          <form action="{% url 'edit_profile' user.username %}" method="post">
            {% csrf_token %}
            {% for field in profile_form.visible_fields|slice:"0:3" %}
              <div class="row">
                <div class="col-sm-4">{{ field.help_text }}</div>
                <div class="col">{{ field }}</div>
              </div>
              <div class="row">
                <div class="col-sm-4">&nbsp;</div>
                <div class="col">{{ field.errors }}</div>
              </div>
            {% endfor %}
            <!-- Auto fill fields that have values -->
            <script type="text/javascript">
              document.getElementById("id_display_name").value = "{{ profile.display_name }}";
              document.getElementById("id_email").value = "{{ profile.user.email }}";
              document.getElementById("id_date_of_birth").value = "{{ profile.date_of_birth }}";
            </script>
            <!-- Print validation error messages -->
            {% if profile_form.non_field_errors %}
        	    <div class="row">
        	      <div class="col-sm-4">&nbsp;</div>
        		    <div class="col text-danger">{{ profile_form.non_field_errors|striptags }}</div>
        		  </div>
            {% endif %}
            <!-- Submit button -->
            <div class="form-row clearfix">
              <button class="float-right btn btn-secondary"
                type="submit" name="details_button">Submit</button>
            </div>
          </form>

          <!-- Change Password -->
          <h3>Password</h3>
          <form action="{% url 'edit_profile' user.username %}" method="post">
            {% csrf_token %}
            {% for field in user_form.visible_fields|slice:"2:" %}
              <div class="row">
                <div class="col-sm-4">{{ field.help_text }}</div>
                <div class="col">{{ field }}</div>
              </div>
              <div class="row">
                <div class="col-sm-4">&nbsp;</div>
                <div class="col">{{ field.errors }}</div>
              </div>
            {% endfor %}
            <!-- Print validation error messages -->
            {% if user_form.non_field_errors %}
        	    <div class="row">
        	      <div class="col-sm-4">&nbsp;</div>
        		    <div class="col text-danger">{{ user_form.non_field_errors|striptags }}</div>
        		  </div>
            {% endif %}
            <!-- Submit button -->
            <div class="form-row clearfix">
              <button class="float-right btn btn-secondary"
                type="submit" name="password_button">Submit</button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Biography -->
    <div class="row">
      <div class="col">
        <h2>{{ profile_form.biography.help_text }}</h2>
        <div class="container-fluid p-5">
          <form action="{% url 'edit_profile' user.username %}" method="post">
            {% csrf_token %}
            <div class="row">
              <div class="col">
                {{ profile_form.biography }}
              </div>
            </div>
            <!-- Submit button -->
            <div class="form-row clearfix">
              <button class="float-right btn btn-secondary"
              type="submit" name="biography_button">Submit</button>
            </div>
            <script type="text/javascript">
              document.getElementById("id_biography").value = "{{ profile.biography }}";
            </script>
          </form>
        </div>
      </div>
    </div>
  </div><!-- Container -->

  <!--<form action="{% url 'edit_profile' user.username %}"
    method="POST" id="profileForm">
    {% csrf_token %}
    <div class="row px-5">
      <!-- Profile Pic -->
      <!--<div class="col-sm-4 mr-3">
        <h2>{{ profile_form.profile_image.help_text }}</h2>
        <div class="container-fluid" style="max-height:300px;">
          <div class="row">
            <img src="{{ profile_form.profile_image }}" alt="profile image">
          </div>
          <div class="row">
            {{ profile_form.profile_image }}
          </div>
        </div>
      </div>

      <!-- Details -->
      <!--<div class="col">
        <h2>Details</h2>
        <div class="container-fluid p-5">
          {% for field in user_form.visible_fields %}
            {% if field is not user_form.username %}
              <div class="row">
                <div class="col-sm-4">{{ field.help_text }}</div>
                <div class="col">{{ field }}</div>
              </div>
              <div class="row">
                <div class="col-sm-4">&nbsp;</div>
                <div class="col">{{ field.errors }}</div>
              </div>
            {% endif %}
          {% endfor %}
          <div class="row">
            <div class="col-sm-4">{{ profile_form.date_of_birth.help_text }}</div>
            <div class="col">{{ profile_form.date_of_birth }}</div>
          </div>
          <div class="row">
            <div class="col-sm-4">&nbsp;</div>
            <div class="col">{{ profile_form.date_of_birth.errors }}</div>
          </div>
        </div><!-- Details -->
      <!--</div>
    </div><!-- Row -->

    <!-- Biography -->
    <!--<h2>{{ profile_form.biography.help_text }}</h2>
    <div class="row px-5">
      <div class="container-fluid w-100 p-5">
          {{ profile_form.biography }}
      </div>
    </div>

    <!-- Submit Button -->
    <!--<div class="row my-5">
      <button class="btn btn-primary float-right"
      type="submit" form="profileForm">Submit</button>
    </div>
  </form>-->
{% endblock %}
